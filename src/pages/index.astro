---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { formatDate } from '../utils/date';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 10);
---

<BaseLayout title="Home">
  <section class="mb-12">
    <div class="flex items-center gap-6 mb-8">
      <img
        src="/avatar.svg"
        alt="Deepu"
        class="w-24 h-24 rounded-full border-2 border-[#e5e5e5]"
      />
      <div>
        <h1 class="text-2xl font-bold text-[#282728] mb-2">Hi, I'm Deepu.</h1>
        <p class="text-[#666]">
          Building with LLMs, shipping products, thinking out loud.
        </p>
      </div>
    </div>

    <div class="flex gap-4">
      <a href="https://x.com/deepu_k" class="text-[#666] hover:text-[#282728] transition-colors">
        X
      </a>
      <a href="/rss.xml" class="text-[#666] hover:text-[#282728] transition-colors">
        RSS
      </a>
    </div>
  </section>

  <hr class="border-[#e5e5e5] my-8" />

  <section>
    <h2 class="text-xl font-semibold text-[#282728] mb-6">Recent Posts</h2>
    <ul class="space-y-6">
      {posts.map(post => (
        <li>
          <a href={`/posts/${post.slug}`} class="group block">
            <h3 class="text-lg font-medium text-[#282728] group-hover:text-accent transition-colors">
              {post.data.title}
            </h3>
            <p class="text-[#666] text-sm mt-1">
              {post.data.description}
            </p>
            <div class="text-[#999] text-xs mt-2">
              {formatDate(post.data.pubDate)}
              {post.data.tags.length > 0 && (
                <span class="ml-2">
                  • {post.data.tags.slice(0, 3).map(t => `#${t}`).join(' ')}
                </span>
              )}
            </div>
          </a>
        </li>
      ))}
    </ul>

    {posts.length >= 10 && (
      <a
        href="/posts"
        class="inline-block mt-8 text-accent hover:text-accent-dark transition-colors"
      >
        View all posts →
      </a>
    )}
  </section>
</BaseLayout>
